import{d as R,r as m,L as h,o as I,I as g,e as y,g as o,w as t,i as r,l as v,H as N,M as q,h as p,f as A,E as w,k as B,_ as E}from"./index-CtaRNcZl.js";const M={class:"login-container"},U={key:0,class:"tips"},K=R({__name:"AdminLogin",setup(F){const c=B(),_=m(),l=m(!1),d=m(!1),a=h({username:"",password:""}),k={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},f=async()=>{var s,e;try{await _.value.validate(),l.value=!0;const n=await g.post("/api/admin/login",a);localStorage.setItem("admin_token",n.data.access_token),w.success("登录成功"),c.push("/admin")}catch(n){w.error(((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.detail)||"登录失败")}finally{l.value=!1}},V=()=>{c.push("/admin/register")};return I(async()=>{var s;try{const e=await g.get("/api/admin/can-register");d.value=!!((s=e.data)!=null&&s.can_register)}catch{d.value=!1}}),(s,e)=>{const n=r("el-input"),i=r("el-form-item"),x=r("el-button"),C=r("el-link"),b=r("el-form"),L=r("el-card");return v(),y("div",M,[o(L,{class:"login-card"},{header:t(()=>[...e[2]||(e[2]=[A("h2",null,"AI小说平台 - 管理后台登录",-1)])]),default:t(()=>[o(b,{model:a,rules:k,ref_key:"formRef",ref:_},{default:t(()=>[o(i,{prop:"username"},{default:t(()=>[o(n,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=u=>a.username=u),placeholder:"用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),o(i,{prop:"password"},{default:t(()=>[o(n,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=u=>a.password=u),type:"password",placeholder:"密码","prefix-icon":"Lock",onKeyup:q(f,["enter"])},null,8,["modelValue"])]),_:1}),o(i,null,{default:t(()=>[o(x,{type:"primary",style:{width:"100%"},loading:l.value,onClick:f},{default:t(()=>[...e[3]||(e[3]=[p(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1}),d.value?(v(),y("div",U,[e[5]||(e[5]=p(" 首次使用？",-1)),o(C,{type:"primary",onClick:V},{default:t(()=>[...e[4]||(e[4]=[p("注册管理员",-1)])]),_:1})])):N("",!0)]),_:1},8,["model"])]),_:1})])}}}),S=E(K,[["__scopeId","data-v-a1e6057b"]]);export{S as default};
