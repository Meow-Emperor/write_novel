import{d as oe,u as ae,Y as q,r as f,o as ne,E as y,C as b,w as o,i as s,l as r,f as u,e as V,H as I,g as l,F,t as G,h as p,G as A,a2 as se,D as ue,a1 as re,a5 as de,A as ie,z as me,p as pe,K as H,_ as ve}from"./index-CtaRNcZl.js";const ce={class:"assistant-dialog"},_e={key:0,class:"step-select"},fe={class:"assistant-icon"},Ve={class:"description"},ge={class:"step-actions"},ye={key:1,class:"step-generate"},be={class:"step-actions"},ke={key:2,class:"step-result"},Ce={key:0,class:"multiple-versions"},we={class:"version-content"},Ie={class:"version-actions"},Ae={key:1,class:"single-result"},Ue={class:"step-actions"},xe=oe({__name:"AIAssistantDialog",props:{modelValue:{type:Boolean},novelId:{}},emits:["update:modelValue","content-generated"],setup(K,{emit:L}){const M=K,B=L,v=ae(),U=q({get:()=>M.modelValue,set:n=>B("update:modelValue",n)}),i=f(1),m=f(null),x=f([]),O=q(()=>v.generating),a=f({userInput:"",provider:v.config.provider,modelName:v.config.model_name,temperature:v.config.temperature??.7,numVersions:2}),c=f(""),d=f([]),N=f("0");ne(async()=>{try{await v.fetchAssistants(),x.value=v.assistants}catch{y.error("加载助手列表失败")}});function P(n){return{conceptualizer:H,blueplanner:pe,outliner:me,novelist:ie,extractor:de,evaluator:re}[n]||H}function R(n){if(!n)return"";const e=x.value.find(z=>z.role===n);return(e==null?void 0:e.name)||n}function W(n){m.value=n}async function Y(){if(!m.value||!a.value.userInput){y.warning("请选择助手并输入创作需求");return}try{const n={role:m.value,novel_id:M.novelId,user_input:a.value.userInput,provider:a.value.provider,model_name:a.value.modelName,temperature:a.value.temperature};if(m.value==="novelist"&&a.value.numVersions>1){const e=await v.generateMultipleVersions(n,a.value.numVersions);d.value=e,c.value=""}else{const e=await v.generateWithAssistant(n);c.value=e,d.value=[]}i.value=3,y.success("生成成功")}catch(n){y.error(n.message||"生成失败")}}function j(n){c.value=n,d.value=[]}function J(){c.value?(B("content-generated",c.value),$(),y.success("内容已应用")):d.value.length>0&&y.warning("请先选择一个版本")}function $(){U.value=!1,setTimeout(()=>{i.value=1,m.value=null,a.value.userInput="",c.value="",d.value=[],N.value="0"},300)}return(n,e)=>{const z=s("el-icon"),Q=s("el-card"),k=s("el-col"),S=s("el-row"),_=s("el-button"),X=s("el-tag"),C=s("el-form-item"),w=s("el-input"),D=s("el-option"),Z=s("el-select"),T=s("el-input-number"),h=s("el-form"),ee=s("el-tab-pane"),le=s("el-tabs"),te=s("el-dialog");return r(),b(te,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=t=>U.value=t),title:"AI 创作助手",width:"80%","close-on-click-modal":!1,onClose:$},{default:o(()=>[u("div",ce,[i.value===1?(r(),V("div",_e,[e[14]||(e[14]=u("h3",null,"选择助手类型",-1)),l(S,{gutter:20},{default:o(()=>[(r(!0),V(F,null,G(x.value,t=>(r(),b(k,{key:t.role,span:8},{default:o(()=>[l(Q,{class:se(["assistant-card",{active:m.value===t.role}]),shadow:"hover",onClick:g=>W(t.role)},{default:o(()=>[u("div",fe,[l(z,{size:40},{default:o(()=>[(r(),b(ue(P(t.role))))]),_:2},1024)]),u("h4",null,A(t.name),1),u("p",Ve,A(t.description),1)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),u("div",ge,[l(_,{onClick:$},{default:o(()=>[...e[12]||(e[12]=[p("取消",-1)])]),_:1}),l(_,{type:"primary",disabled:!m.value,onClick:e[0]||(e[0]=t=>i.value=2)},{default:o(()=>[...e[13]||(e[13]=[p(" 下一步 ",-1)])]),_:1},8,["disabled"])])])):I("",!0),i.value===2?(r(),V("div",ye,[l(h,{model:a.value,"label-width":"100px"},{default:o(()=>[l(C,{label:"助手类型"},{default:o(()=>[l(X,{type:"primary",size:"large"},{default:o(()=>[p(A(R(m.value)),1)]),_:1}),l(_,{size:"small",style:{"margin-left":"10px"},onClick:e[1]||(e[1]=t=>i.value=1)},{default:o(()=>[...e[15]||(e[15]=[p(" 更换助手 ",-1)])]),_:1})]),_:1}),l(C,{label:"创作需求",required:""},{default:o(()=>[l(w,{modelValue:a.value.userInput,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.userInput=t),type:"textarea",rows:6,placeholder:"请详细描述您的创作需求..."},null,8,["modelValue"])]),_:1}),l(C,{label:"AI 配置"},{default:o(()=>[l(S,{gutter:10},{default:o(()=>[l(k,{span:8},{default:o(()=>[l(Z,{modelValue:a.value.provider,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.provider=t),placeholder:"Provider"},{default:o(()=>[l(D,{label:"OpenAI",value:"openai"}),l(D,{label:"Anthropic",value:"anthropic"}),l(D,{label:"Custom",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),l(k,{span:8},{default:o(()=>[l(w,{modelValue:a.value.modelName,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.modelName=t),placeholder:"Model (e.g., gpt-4)"},null,8,["modelValue"])]),_:1}),l(k,{span:8},{default:o(()=>[l(T,{modelValue:a.value.temperature,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.temperature=t),min:0,max:2,step:.1,placeholder:"Temperature",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),m.value==="novelist"?(r(),b(C,{key:0,label:"生成版本数"},{default:o(()=>[l(T,{modelValue:a.value.numVersions,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.numVersions=t),min:1,max:5,style:{width:"100%"}},null,8,["modelValue"]),e[16]||(e[16]=u("span",{class:"form-tip"},"小说家助手支持生成多个版本供您选择",-1))]),_:1})):I("",!0)]),_:1},8,["model"]),u("div",be,[l(_,{onClick:e[7]||(e[7]=t=>i.value=1)},{default:o(()=>[...e[17]||(e[17]=[p("上一步",-1)])]),_:1}),l(_,{type:"primary",loading:O.value,disabled:!a.value.userInput,onClick:Y},{default:o(()=>[...e[18]||(e[18]=[p(" 开始生成 ",-1)])]),_:1},8,["loading","disabled"])])])):I("",!0),i.value===3?(r(),V("div",ke,[d.value.length>0?(r(),V("div",Ce,[u("h3",null,"生成的版本（共 "+A(d.value.length)+" 个）",1),l(le,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=t=>N.value=t)},{default:o(()=>[(r(!0),V(F,null,G(d.value,(t,g)=>(r(),b(ee,{key:g,label:`版本 ${g+1}`,name:String(g)},{default:o(()=>[u("div",we,[l(w,{modelValue:d.value[g],"onUpdate:modelValue":E=>d.value[g]=E,type:"textarea",rows:20,readonly:""},null,8,["modelValue","onUpdate:modelValue"]),u("div",Ie,[l(_,{type:"primary",onClick:E=>j(t)},{default:o(()=>[...e[19]||(e[19]=[p(" 使用此版本 ",-1)])]),_:1},8,["onClick"])])])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])])):(r(),V("div",Ae,[e[20]||(e[20]=u("h3",null,"生成结果",-1)),l(w,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value=t),type:"textarea",rows:20,readonly:""},null,8,["modelValue"])])),u("div",Ue,[l(_,{onClick:e[10]||(e[10]=t=>i.value=2)},{default:o(()=>[...e[21]||(e[21]=[p("重新生成",-1)])]),_:1}),l(_,{type:"primary",onClick:J},{default:o(()=>[...e[22]||(e[22]=[p(" 使用内容 ",-1)])]),_:1})])])):I("",!0)])]),_:1},8,["modelValue"])}}}),$e=ve(xe,[["__scopeId","data-v-0612d66c"]]);export{$e as A};
