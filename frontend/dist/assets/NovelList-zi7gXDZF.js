import{d as Z,a as ee,r as V,o as te,E as y,e as w,f as u,g as e,h as c,w as l,i as s,j as r,P as le,Q as ae,C as S,l as p,n as oe,S as T,F as se,t as ne,k as re,G as h,T as ie,U as de,A as ue,V as ce,H as M,v as _e,W as pe,X as fe,R as me,_ as ve}from"./index-CtaRNcZl.js";const ge={class:"novel-list"},ye={class:"page-header"},we={class:"header-left"},he={class:"page-title"},be={class:"header-right"},Ve={key:0,class:"empty-state"},ke={key:1,class:"novels-grid"},Ce={class:"card-header"},De={class:"card-body"},Ne={class:"novel-title"},Re={class:"novel-meta"},xe={key:0},Ee={key:1},Se={class:"novel-description"},Te={class:"card-footer"},Me={class:"date-info"},Le=Z({__name:"NovelList",setup(Be){const L=re(),_=ee(),f=V(!1),m=V(null),C=V(!1),k=V(),n=V({title:"",author:"",genre:"",status:"DRAFT",description:""}),B={title:[{required:!0,message:"请输入小说标题",trigger:"blur"},{min:1,max:200,message:"标题长度为 1 到 200 个字符",trigger:"blur"}]};te(async()=>{try{await _.fetchNovels()}catch{y.error("加载小说列表失败")}});function P(a){L.push(`/novels/${a.id}`)}function N(){m.value=null,f.value=!0,n.value={title:"",author:"",genre:"",status:"DRAFT",description:""}}function U(a){m.value=a,n.value={title:a.title,author:a.author??"",genre:a.genre??"",status:a.status,description:a.description??""},f.value=!0}function F(){var a;f.value=!1,(a=k.value)==null||a.resetFields()}async function I(){k.value&&await k.value.validate(async a=>{if(a){C.value=!0;try{m.value?(await _.updateNovel(m.value.id,n.value),y.success("更新成功")):(await _.createNovel(n.value),y.success("创建成功")),f.value=!1}catch{y.error(m.value?"更新失败":"创建失败")}finally{C.value=!1}}})}async function A(a,t){if(a==="edit")U(t);else if(a==="delete")try{await me.confirm(`确定要删除《${t.title}》吗？此操作不可恢复。`,"删除确认",{type:"warning",confirmButtonText:"确定删除",cancelButtonText:"取消"}),await _.deleteNovel(t.id),y.success("删除成功")}catch(i){i!=="cancel"&&y.error("删除失败")}}function O(a){return{DRAFT:"info",IN_PROGRESS:"warning",COMPLETED:"success",PUBLISHED:"primary"}[a]??"info"}function G(a){return{DRAFT:"草稿",IN_PROGRESS:"进行中",COMPLETED:"已完成",PUBLISHED:"已发布"}[a]??a}function z(a){return{fantasy:"奇幻","sci-fi":"科幻",modern:"现代",historical:"历史",mystery:"悬疑",romance:"言情",wuxia:"武侠",other:"其他"}[a]??a}function H(a){const t=new Date(a),v=new Date().getTime()-t.getTime(),g=Math.floor(v/(1e3*60*60*24));return g===0?"今天":g===1?"昨天":g<7?`${g}天前`:t.toLocaleDateString("zh-CN",{month:"2-digit",day:"2-digit"})}return(a,t)=>{const i=s("el-icon"),v=s("el-button"),g=s("el-empty"),$=s("el-tag"),R=s("el-dropdown-item"),j=s("el-dropdown-menu"),q=s("el-dropdown"),Q=s("el-card"),W=s("el-col"),X=s("el-row"),D=s("el-input"),b=s("el-form-item"),d=s("el-option"),x=s("el-select"),J=s("el-form"),K=s("el-dialog"),Y=ae("loading");return p(),w("div",ge,[u("div",ye,[u("div",we,[u("h1",he,[e(i,{size:32},{default:l(()=>[e(r(oe))]),_:1}),t[7]||(t[7]=c(" 我的小说 ",-1))]),t[8]||(t[8]=u("p",{class:"page-subtitle"},"管理和组织你的创作作品",-1))]),u("div",be,[e(v,{type:"primary",size:"large",onClick:N,round:""},{default:l(()=>[e(i,null,{default:l(()=>[e(r(T))]),_:1}),t[9]||(t[9]=c(" 创建新小说 ",-1))]),_:1})])]),r(_).novels.length===0&&!r(_).loading?(p(),w("div",Ve,[e(g,{description:"还没有小说作品"},{default:l(()=>[e(v,{type:"primary",onClick:N,round:""},{default:l(()=>[e(i,null,{default:l(()=>[e(r(T))]),_:1}),t[10]||(t[10]=c(" 创建第一部小说 ",-1))]),_:1})]),_:1})])):(p(),w("div",ke,[le((p(),S(X,{gutter:24},{default:l(()=>[(p(!0),w(se,null,ne(r(_).novels,o=>(p(),S(W,{xs:24,sm:12,lg:8,key:o.id},{default:l(()=>[e(Q,{class:"novel-card",shadow:"hover",onClick:E=>P(o)},{default:l(()=>[u("div",Ce,[e($,{type:O(o.status),size:"small"},{default:l(()=>[c(h(G(o.status)),1)]),_:2},1032,["type"]),e(q,{onCommand:E=>A(E,o),trigger:"click",onClick:t[0]||(t[0]=ie(()=>{},["stop"]))},{dropdown:l(()=>[e(j,null,{default:l(()=>[e(R,{command:"edit"},{default:l(()=>[e(i,null,{default:l(()=>[e(r(ue))]),_:1}),t[11]||(t[11]=c(" 编辑 ",-1))]),_:1}),e(R,{command:"delete",divided:""},{default:l(()=>[e(i,null,{default:l(()=>[e(r(ce))]),_:1}),t[12]||(t[12]=c(" 删除 ",-1))]),_:1})]),_:1})]),default:l(()=>[e(i,{class:"more-icon"},{default:l(()=>[e(r(de))]),_:1})]),_:1},8,["onCommand"])]),u("div",De,[u("h3",Ne,h(o.title),1),u("div",Re,[o.author?(p(),w("span",xe,[e(i,null,{default:l(()=>[e(r(_e))]),_:1}),c(" "+h(o.author),1)])):M("",!0),o.genre?(p(),w("span",Ee,[e(i,null,{default:l(()=>[e(r(pe))]),_:1}),c(" "+h(z(o.genre)),1)])):M("",!0)]),u("p",Se,h(o.description||"暂无简介"),1)]),u("div",Te,[u("span",Me,[e(i,null,{default:l(()=>[e(r(fe))]),_:1}),c(" "+h(H(o.created_at)),1)])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),[[Y,r(_).loading]])])),e(K,{modelValue:f.value,"onUpdate:modelValue":t[6]||(t[6]=o=>f.value=o),title:m.value?"编辑小说":"创建新小说",width:"600px","destroy-on-close":""},{footer:l(()=>[e(v,{onClick:F},{default:l(()=>[...t[13]||(t[13]=[c("取消",-1)])]),_:1}),e(v,{type:"primary",onClick:I,loading:C.value},{default:l(()=>[...t[14]||(t[14]=[c("保存",-1)])]),_:1},8,["loading"])]),default:l(()=>[e(J,{model:n.value,"label-width":"80px",rules:B,ref_key:"formRef",ref:k},{default:l(()=>[e(b,{label:"标题",prop:"title"},{default:l(()=>[e(D,{modelValue:n.value.title,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.title=o),placeholder:"请输入小说标题"},null,8,["modelValue"])]),_:1}),e(b,{label:"作者",prop:"author"},{default:l(()=>[e(D,{modelValue:n.value.author,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.author=o),placeholder:"请输入作者名称"},null,8,["modelValue"])]),_:1}),e(b,{label:"类型",prop:"genre"},{default:l(()=>[e(x,{modelValue:n.value.genre,"onUpdate:modelValue":t[3]||(t[3]=o=>n.value.genre=o),placeholder:"选择类型",style:{width:"100%"}},{default:l(()=>[e(d,{label:"奇幻",value:"fantasy"}),e(d,{label:"科幻",value:"sci-fi"}),e(d,{label:"现代",value:"modern"}),e(d,{label:"历史",value:"historical"}),e(d,{label:"悬疑",value:"mystery"}),e(d,{label:"言情",value:"romance"}),e(d,{label:"武侠",value:"wuxia"}),e(d,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"状态",prop:"status"},{default:l(()=>[e(x,{modelValue:n.value.status,"onUpdate:modelValue":t[4]||(t[4]=o=>n.value.status=o),placeholder:"选择状态",style:{width:"100%"}},{default:l(()=>[e(d,{label:"草稿",value:"DRAFT"}),e(d,{label:"进行中",value:"IN_PROGRESS"}),e(d,{label:"已完成",value:"COMPLETED"}),e(d,{label:"已发布",value:"PUBLISHED"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"简介",prop:"description"},{default:l(()=>[e(D,{modelValue:n.value.description,"onUpdate:modelValue":t[5]||(t[5]=o=>n.value.description=o),type:"textarea",rows:4,placeholder:"请输入小说简介，让读者了解你的作品",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ue=ve(Le,[["__scopeId","data-v-8b0abf3b"]]);export{Ue as default};
