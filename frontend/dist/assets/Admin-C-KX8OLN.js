import{d as ie,r as f,o as re,e as S,g as e,w as a,i as s,I as c,E as r,k as me,l as y,f as p,j as I,N as pe,O as _e,v as fe,G as k,h as d,H as U,P as G,Q as ce,C as H,R as j,_ as ve}from"./index-CtaRNcZl.js";const ye={class:"admin-container"},ge={class:"header-right"},we={key:0,class:"dashboard"},be={key:1,class:"novels-management"},Ve={key:2,class:"admins-management"},ke=ie({__name:"Admin",setup(Ce){const h=me(),g=f("dashboard"),v=f(!1),w=f({}),B=f([]),M=f([]),z=f(null),b=f(!1),o=f({username:"",email:"",full_name:"",password:"",is_superuser:!1}),q=n=>{g.value=n,n==="novels"?L():n==="admins"?$():n==="dashboard"&&R()},R=async()=>{try{const n=await c.get("/api/admin/stats");w.value=n.data}catch{r.error("加载统计数据失败")}},L=async()=>{v.value=!0;try{const n=await c.get("/api/admin/novels");B.value=n.data}catch{r.error("加载小说列表失败")}finally{v.value=!1}},$=async()=>{v.value=!0;try{const n=await c.get("/api/admin/admins");M.value=n.data}catch{r.error("加载管理员列表失败")}finally{v.value=!1}},F=async()=>{try{const n=await c.get("/api/admin/me");z.value=n.data}catch{r.error("加载管理员信息失败"),h.push("/admin/login")}},Q=async()=>{var n,l;try{await c.post("/api/admin/register",o.value),r.success("添加管理员成功"),b.value=!1,o.value={username:"",email:"",full_name:"",password:"",is_superuser:!1},$()}catch(i){r.error(((l=(n=i.response)==null?void 0:n.data)==null?void 0:l.detail)||"添加管理员失败")}},J=n=>{r.info("编辑功能待实现")},K=async n=>{var l,i;try{await j.confirm("确定要删除该管理员吗？","警告",{type:"warning"}),await c.delete(`/api/admin/admins/${n}`),r.success("删除成功"),$()}catch(m){m!=="cancel"&&r.error(((i=(l=m.response)==null?void 0:l.data)==null?void 0:i.detail)||"删除失败")}},W=n=>{h.push(`/novels/${n}`)},X=async n=>{var l,i;try{await j.confirm("确定要删除该小说吗？","警告",{type:"warning"}),await c.delete(`/api/novels/${n}`),r.success("删除成功"),L()}catch(m){m!=="cancel"&&r.error(((i=(l=m.response)==null?void 0:l.data)==null?void 0:i.detail)||"删除失败")}},Y=()=>{localStorage.removeItem("admin_token"),h.push("/admin/login")},Z=n=>({DRAFT:"info",IN_PROGRESS:"warning",COMPLETED:"success",PUBLISHED:"success"})[n]||"info",ee=n=>new Date(n).toLocaleString("zh-CN");return re(()=>{F(),R()}),(n,l)=>{const i=s("el-icon"),m=s("el-menu-item"),le=s("el-menu"),ae=s("el-aside"),_=s("el-button"),te=s("el-header"),C=s("el-statistic"),A=s("el-card"),x=s("el-col"),ne=s("el-row"),u=s("el-table-column"),D=s("el-tag"),P=s("el-table"),se=s("el-main"),T=s("el-container"),N=s("el-input"),V=s("el-form-item"),oe=s("el-switch"),ue=s("el-form"),de=s("el-dialog"),O=ce("loading");return y(),S("div",ye,[e(T,null,{default:a(()=>[e(ae,{width:"200px",class:"admin-sidebar"},{default:a(()=>[e(le,{"default-active":g.value,class:"admin-menu",onSelect:q},{default:a(()=>[e(m,{index:"dashboard"},{default:a(()=>[e(i,null,{default:a(()=>[e(I(pe))]),_:1}),l[8]||(l[8]=p("span",null,"仪表盘",-1))]),_:1}),e(m,{index:"novels"},{default:a(()=>[e(i,null,{default:a(()=>[e(I(_e))]),_:1}),l[9]||(l[9]=p("span",null,"小说管理",-1))]),_:1}),e(m,{index:"admins"},{default:a(()=>[e(i,null,{default:a(()=>[e(I(fe))]),_:1}),l[10]||(l[10]=p("span",null,"管理员",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),e(T,null,{default:a(()=>[e(te,{class:"admin-header"},{default:a(()=>{var t;return[l[12]||(l[12]=p("h2",null,"AI小说平台 - 管理后台",-1)),p("div",ge,[p("span",null,k((t=z.value)==null?void 0:t.username),1),e(_,{type:"danger",onClick:Y},{default:a(()=>[...l[11]||(l[11]=[d("退出",-1)])]),_:1})])]}),_:1}),e(se,{class:"admin-content"},{default:a(()=>[g.value==="dashboard"?(y(),S("div",we,[l[13]||(l[13]=p("h3",null,"平台统计",-1)),e(ne,{gutter:20},{default:a(()=>[e(x,{span:6},{default:a(()=>[e(A,{shadow:"hover"},{default:a(()=>{var t;return[e(C,{title:"总小说数",value:((t=w.value.novels)==null?void 0:t.total)||0},null,8,["value"])]}),_:1})]),_:1}),e(x,{span:6},{default:a(()=>[e(A,{shadow:"hover"},{default:a(()=>{var t;return[e(C,{title:"草稿",value:((t=w.value.novels)==null?void 0:t.draft)||0},null,8,["value"])]}),_:1})]),_:1}),e(x,{span:6},{default:a(()=>[e(A,{shadow:"hover"},{default:a(()=>{var t;return[e(C,{title:"进行中",value:((t=w.value.novels)==null?void 0:t.in_progress)||0},null,8,["value"])]}),_:1})]),_:1}),e(x,{span:6},{default:a(()=>[e(A,{shadow:"hover"},{default:a(()=>{var t;return[e(C,{title:"已完成",value:((t=w.value.novels)==null?void 0:t.completed)||0},null,8,["value"])]}),_:1})]),_:1})]),_:1})])):U("",!0),g.value==="novels"?(y(),S("div",be,[l[16]||(l[16]=p("h3",null,"小说管理",-1)),G((y(),H(P,{data:B.value,style:{width:"100%"}},{default:a(()=>[e(u,{prop:"title",label:"标题"}),e(u,{prop:"author",label:"作者"}),e(u,{prop:"genre",label:"类型"}),e(u,{prop:"status",label:"状态"},{default:a(({row:t})=>[e(D,{type:Z(t.status)},{default:a(()=>[d(k(t.status),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"created_at",label:"创建时间"},{default:a(({row:t})=>[d(k(ee(t.created_at)),1)]),_:1}),e(u,{label:"操作",width:"180"},{default:a(({row:t})=>[e(_,{size:"small",onClick:E=>W(t.id)},{default:a(()=>[...l[14]||(l[14]=[d("查看",-1)])]),_:1},8,["onClick"]),e(_,{size:"small",type:"danger",onClick:E=>X(t.id)},{default:a(()=>[...l[15]||(l[15]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,v.value]])])):U("",!0),g.value==="admins"?(y(),S("div",Ve,[l[20]||(l[20]=p("h3",null,"管理员管理",-1)),e(_,{type:"primary",onClick:l[0]||(l[0]=t=>b.value=!0),style:{"margin-bottom":"20px"}},{default:a(()=>[...l[17]||(l[17]=[d(" 添加管理员 ",-1)])]),_:1}),G((y(),H(P,{data:M.value,style:{width:"100%"}},{default:a(()=>[e(u,{prop:"username",label:"用户名"}),e(u,{prop:"email",label:"邮箱"}),e(u,{prop:"full_name",label:"姓名"}),e(u,{prop:"is_superuser",label:"超级管理员"},{default:a(({row:t})=>[e(D,{type:t.is_superuser?"success":"info"},{default:a(()=>[d(k(t.is_superuser?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"is_active",label:"状态"},{default:a(({row:t})=>[e(D,{type:t.is_active?"success":"danger"},{default:a(()=>[d(k(t.is_active?"激活":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(u,{label:"操作",width:"180"},{default:a(({row:t})=>[e(_,{size:"small",onClick:E=>J(t)},{default:a(()=>[...l[18]||(l[18]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(_,{size:"small",type:"danger",onClick:E=>K(t.id)},{default:a(()=>[...l[19]||(l[19]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,v.value]])])):U("",!0)]),_:1})]),_:1})]),_:1}),e(de,{modelValue:b.value,"onUpdate:modelValue":l[7]||(l[7]=t=>b.value=t),title:"添加管理员",width:"500px"},{footer:a(()=>[e(_,{onClick:l[6]||(l[6]=t=>b.value=!1)},{default:a(()=>[...l[21]||(l[21]=[d("取消",-1)])]),_:1}),e(_,{type:"primary",onClick:Q},{default:a(()=>[...l[22]||(l[22]=[d("确定",-1)])]),_:1})]),default:a(()=>[e(ue,{model:o.value,"label-width":"100px"},{default:a(()=>[e(V,{label:"用户名"},{default:a(()=>[e(N,{modelValue:o.value.username,"onUpdate:modelValue":l[1]||(l[1]=t=>o.value.username=t)},null,8,["modelValue"])]),_:1}),e(V,{label:"邮箱"},{default:a(()=>[e(N,{modelValue:o.value.email,"onUpdate:modelValue":l[2]||(l[2]=t=>o.value.email=t)},null,8,["modelValue"])]),_:1}),e(V,{label:"姓名"},{default:a(()=>[e(N,{modelValue:o.value.full_name,"onUpdate:modelValue":l[3]||(l[3]=t=>o.value.full_name=t)},null,8,["modelValue"])]),_:1}),e(V,{label:"密码"},{default:a(()=>[e(N,{modelValue:o.value.password,"onUpdate:modelValue":l[4]||(l[4]=t=>o.value.password=t),type:"password"},null,8,["modelValue"])]),_:1}),e(V,{label:"超级管理员"},{default:a(()=>[e(oe,{modelValue:o.value.is_superuser,"onUpdate:modelValue":l[5]||(l[5]=t=>o.value.is_superuser=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),xe=ve(ke,[["__scopeId","data-v-10c357a7"]]);export{xe as default};
