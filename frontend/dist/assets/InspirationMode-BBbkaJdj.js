import{d as Y,u as Z,r as g,J as ee,e as R,g as l,C as z,H,w as n,i as v,l as V,j as te,K as ae,h as B,f as w,G as J,F as oe,t as le,I as i,E as S,k as ne,_ as se}from"./index-CtaRNcZl.js";import{A as ie}from"./AIAssistantDialog-Ckjeq38U.js";const re={class:"inspiration-mode"},ue={class:"card-header"},de={class:"log"},ce={class:"actions"},pe=Y({__name:"InspirationMode",setup(ve){const K=ne(),a=Z(),u=g({genre:"",concept:""}),I=g(!1),o=g(""),C=g("新故事"),m=g(0),D=g([]),F=g(!1);function r(_){D.value.push(_)}function O(_){u.value.concept=_,S.success("AI 助手内容已应用到故事概念")}async function P(){var _,t,x,k,y,b,A,h,c,N,s,$,q,E,M,U,G;try{if(I.value=!0,m.value=0,D.value=[],o.value)r("✓ 使用现有小说："+o.value);else{C.value=(_=u.value.concept)!=null&&_.trim()?u.value.concept.trim().slice(0,16):"新的故事";const e=await i.post("/api/novels",{title:C.value,genre:u.value.genre||"",description:u.value.concept||"",status:"DRAFT"});o.value=e.data.id,r("✓ 已创建小说："+C.value)}m.value=1;try{const d=((t=(await i.post("/api/ai/generate-world",{novel_id:o.value,focus:"overall",provider:a.config.provider,base_url:a.config.base_url||void 0,api_key:a.config.api_key||void 0,model_name:a.config.model_name||void 0,temperature:a.config.temperature||void 0})).data)==null?void 0:t.content)||"";let f=null;try{f=(x=(await i.get(`/api/worlds/novel/${o.value}`)).data)==null?void 0:x.id}catch{}f||(f=(await i.post("/api/worlds",{novel_id:o.value,era:"",locations:{},rules:{},culture:{}})).data.id),await i.put(`/api/worlds/${f}`,{era:"",locations:{},rules:{note:d},culture:{}}),r("✓ 已生成世界观（可在世界观页面继续完善）")}catch(e){r("⚠ 世界观生成失败: "+(((y=(k=e==null?void 0:e.response)==null?void 0:k.data)==null?void 0:y.detail)||(e==null?void 0:e.message)))}m.value=2;try{const e=await i.post("/api/ai/generate-plot",{novel_id:o.value,plot_type:"main",plot_length:"medium",provider:a.config.provider,base_url:a.config.base_url||void 0,api_key:a.config.api_key||void 0,model_name:a.config.model_name||void 0,temperature:a.config.temperature||void 0});await i.post("/api/plots",{novel_id:o.value,title:"主线",description:((b=e.data)==null?void 0:b.content)||"",key_events:((A=e.data)==null?void 0:A.content)||"",order:1}),r("✓ 已生成主线情节")}catch(e){r("⚠ 主线情节生成失败: "+(((c=(h=e==null?void 0:e.response)==null?void 0:h.data)==null?void 0:c.detail)||(e==null?void 0:e.message)))}m.value=3;const p=[{role:"protagonist",label:"主角"},{role:"antagonist",label:"反派"},{role:"supporting",label:"配角"}];let j=0;for(const e of p)try{const f=((N=(await i.post("/api/ai/generate-character",{novel_id:o.value,character_role:e.role,provider:a.config.provider,base_url:a.config.base_url||void 0,api_key:a.config.api_key||void 0,model_name:a.config.model_name||void 0,temperature:a.config.temperature||void 0})).data)==null?void 0:N.content)||"",W=(f.split(/\r?\n/).map(X=>X.trim()).find(Boolean)||"").replace(/^[-#*\s]+/,"").slice(0,30)||e.label+"（AI）";await i.post("/api/characters",{novel_id:o.value,name:W,role:e.label,description:f}),j++}catch(d){r(`⚠ ${e.label}生成失败: `+((($=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:$.detail)||(d==null?void 0:d.message)))}r(`✓ 已生成核心角色（${j}/3）`),m.value=4;try{const e=await i.post("/api/ai/generate-chapter-outline",{novel_id:o.value,chapter_number:1,provider:a.config.provider,base_url:a.config.base_url||void 0,api_key:a.config.api_key||void 0,model_name:a.config.model_name||void 0,temperature:a.config.temperature||void 0});await i.post("/api/chapters/",{novel_id:o.value,title:"第一章",chapter_number:1,summary:((q=e.data)==null?void 0:q.content)||"",status:"DRAFT",word_count:0}),r("✓ 已生成第一章大纲")}catch(e){r("⚠ 第一章大纲生成失败: "+(((M=(E=e==null?void 0:e.response)==null?void 0:E.data)==null?void 0:M.detail)||(e==null?void 0:e.message)))}m.value=5,S.success("灵感模式完成，已生成基础雏形！")}catch(p){S.error(((G=(U=p==null?void 0:p.response)==null?void 0:U.data)==null?void 0:G.detail)||(p==null?void 0:p.message)||"运行失败")}finally{I.value=!1}}function Q(){o.value&&K.push(`/novels/${o.value}`)}const T=ee().query.novelId||"";return T&&(o.value=T),(_,t)=>{const x=v("el-tag"),k=v("el-input"),y=v("el-form-item"),b=v("el-button"),A=v("el-form"),h=v("el-card"),c=v("el-step"),N=v("el-steps");return V(),R("div",re,[l(h,{class:"intro-card"},{header:n(()=>[w("div",ue,[t[4]||(t[4]=w("h2",null,"灵感模式 · 对话式引导",-1)),o.value?(V(),z(x,{key:0,type:"success"},{default:n(()=>[B("已创建："+J(C.value),1)]),_:1})):H("",!0)])]),default:n(()=>[l(A,{"label-width":"100px",disabled:I.value},{default:n(()=>[l(y,{label:"题材/类型"},{default:n(()=>[l(k,{modelValue:u.value.genre,"onUpdate:modelValue":t[0]||(t[0]=s=>u.value.genre=s),placeholder:"如：奇幻、科幻、现代、历史等"},null,8,["modelValue"])]),_:1}),l(y,{label:"故事概念"},{default:n(()=>[l(k,{type:"textarea",rows:3,modelValue:u.value.concept,"onUpdate:modelValue":t[1]||(t[1]=s=>u.value.concept=s),placeholder:"一句话或一小段描述你的想法"},null,8,["modelValue"])]),_:1}),l(y,null,{default:n(()=>[l(b,{type:"success",onClick:t[2]||(t[2]=s=>F.value=!0),icon:te(ae)},{default:n(()=>[...t[5]||(t[5]=[B(" AI 助手引导 ",-1)])]),_:1},8,["icon"]),l(b,{type:"primary",onClick:P,loading:I.value},{default:n(()=>[...t[6]||(t[6]=[B("开始构建故事雏形",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["disabled"])]),_:1}),o.value?(V(),z(h,{key:0,class:"steps-card"},{header:n(()=>[...t[7]||(t[7]=[w("div",{class:"card-header"},[w("span",null,"自动生成进度")],-1)])]),default:n(()=>[l(N,{active:m.value,"finish-status":"success"},{default:n(()=>[l(c,{title:"创建小说"}),l(c,{title:"世界观设定"}),l(c,{title:"主线情节"}),l(c,{title:"核心角色"}),l(c,{title:"首章大纲"})]),_:1},8,["active"]),w("div",de,[(V(!0),R(oe,null,le(D.value,(s,$)=>(V(),R("div",{key:$,class:"log-line"},J(s),1))),128))]),w("div",ce,[l(b,{type:"primary",onClick:Q,disabled:!o.value},{default:n(()=>[...t[8]||(t[8]=[B("进入小说详情",-1)])]),_:1},8,["disabled"])])]),_:1})):H("",!0),l(ie,{modelValue:F.value,"onUpdate:modelValue":t[3]||(t[3]=s=>F.value=s),"novel-id":o.value||"temp",onContentGenerated:O},null,8,["modelValue","novel-id"])])}}}),ge=se(pe,[["__scopeId","data-v-c79a3a63"]]);export{ge as default};
