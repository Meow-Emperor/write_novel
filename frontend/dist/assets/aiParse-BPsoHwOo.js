function u(r){return(r||"").split(/\r?\n/).map(n=>n.trim()).filter(n=>n.length>0)}function f(r,n){const e=[];let c=n+1;for(;c<r.length;c++){const t=r[c];if(/^#{1,6}\s+/.test(t))break;if(/^\d+\.|^[-*]\s/.test(t)){e.push(t);continue}if(/^[A-Za-z\u4e00-\u9fa5][\w\u4e00-\u9fa5\s]+[:：]$/.test(t)||/^(Chapter|Plot|角色|人物|外貌|性格|背景|关系|冲突|地点|规则|文化)[:：]/i.test(t))break;e.push(t)}return{content:e.join(`
`),end:c}}function p(r){const n=u(r),e={name:"",role:"",description:"",personality:"",background:"",appearance:"",relationships:""};for(const t of n){const s=t.match(/^(Character\s*Name|角色名称|姓名)[:：]\s*(.+)$/i);if(s&&s[2]){e.name=s[2].trim();break}}for(const t of n){const s=t.match(/^(Role|角色)[:：]\s*(.+)$/i);if(s&&s[2]){e.role=s[2].trim();break}}const c={"Physical Appearance":"appearance",外貌描述:"appearance",外貌:"appearance","Personality Traits":"personality",性格特点:"personality",性格:"personality","Background Story":"background",背景故事:"background",背景:"background",Relationships:"relationships",人物关系:"relationships",关系:"relationships",Description:"description",描述:"description"};for(let t=0;t<n.length;t++){const s=n[t],i=Object.keys(c).find(o=>new RegExp(`^${o}[:：]`,"i").test(s));if(i){const{content:o,end:a}=f(n,t),l=c[i];e[l]=o||e[l],t=a-1}}return e.description||(e.description=r),e}function m(r){const n=u(r),e={title:"",description:"",key_events:"",characters:"",conflicts:""};for(const t of n){const s=t.match(/^(Plot\s*Title|标题)[:：]\s*(.+)$/i);if(s&&s[2]){e.title=s[2].trim();break}}const c={"Main Conflict":"description",Hook:"description",主要冲突:"description","Key Plot Points":"key_events",关键事件:"key_events","Character Involvement":"characters",角色参与:"characters",Conflicts:"conflicts",冲突:"conflicts"};for(let t=0;t<n.length;t++){const s=n[t],i=Object.keys(c).find(o=>new RegExp(`^${o}([s]*|[:：])`,"i").test(s));if(i){const{content:o,end:a}=f(n,t),l=c[i];e[l]=o||e[l],t=a-1}}return e.title||(e.title="AI 生成情节"),e.description||(e.description=r),e.key_events||(e.key_events=r),e}function y(r){const n=u(r),e={title:"",summary:"",keyEvents:""};for(const t of n){const s=t.match(/^(Chapter\s*Title|章节标题)[:：]\s*(.+)$/i);if(s&&s[2]){e.title=s[2].trim();break}}const c={"Chapter Summary":"summary",章节概要:"summary",Summary:"summary","Key Events":"keyEvents",关键事件:"keyEvents"};for(let t=0;t<n.length;t++){const s=n[t],i=Object.keys(c).find(o=>new RegExp(`^${o}[:：]`,"i").test(s));if(i){const{content:o,end:a}=f(n,t),l=c[i];e[l]=o||e[l],t=a-1}}return e.summary||(e.summary=r),e}function d(r){const n=u(r),e={era:"",rules:{},locations:{},culture:{}},c=(t,s)=>{const i=u(s);for(const o of i){const a=o.match(/^[-*\d\.\)]?\s*([^:：]{1,50})[:：]\s*(.+)$/);a&&a[1]&&a[2]&&(t[a[1].trim()]=a[2].trim())}};for(let t=0;t<n.length;t++){const s=n[t];if(/^(Era|Time|时代)[\s]*[:：]/i.test(s)){const{content:i,end:o}=f(n,t);e.era=i||e.era,t=o-1;continue}if(/^(Rules|Laws|规则|法则)[:：]/i.test(s)){const{content:i,end:o}=f(n,t);c(e.rules,i),t=o-1;continue}if(/^(Locations|Places|地点|场景)[:：]/i.test(s)){const{content:i,end:o}=f(n,t);c(e.locations,i),t=o-1;continue}if(/^(Culture|文化)[:：]/i.test(s)){const{content:i,end:o}=f(n,t);c(e.culture,i),t=o-1;continue}}return e}export{m as a,d as b,y as c,p};
