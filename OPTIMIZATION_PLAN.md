# ç³»ç»Ÿä¼˜åŒ–æ–¹æ¡ˆ

## å¯¹æ¯”åˆ†æï¼šå½“å‰é¡¹ç›® vs Arboris-Novel

### å½“å‰é¡¹ç›®ä¼˜åŠ¿

#### 1. åŠŸèƒ½å®Œæ•´æ€§ âœ…
- å®Œæ•´çš„åˆ›ä½œé“¾è·¯ï¼šå°è¯´ç®¡ç† â†’ ä¸–ç•Œè§‚ â†’ è§’è‰² â†’ æƒ…èŠ‚ â†’ ç« èŠ‚ â†’ å†…å®¹ç¼–è¾‘
- çµæ„Ÿæ¨¡å¼ï¼šå¯¹è¯å¼å¼•å¯¼å¿«é€Ÿæ­å»ºé›å½¢
- ç»“æ„åŒ–æ•°æ®ç®¡ç†ï¼šè§’è‰²å…³ç³»ã€ä¸–ç•Œè§‚è®¾å®šã€æƒ…èŠ‚æ¶æ„
- ç°ä»£åŒ– UIï¼šElement Plus + Vue3ï¼Œå“åº”å¼å¸ƒå±€

#### 2. æŠ€æœ¯æ¶æ„ âœ…
- æ¸…æ™°çš„å‰åç«¯åˆ†ç¦»
- ç±»å‹å®‰å…¨ï¼ˆTypeScript + Pydanticï¼‰
- å¤š AI provider æ”¯æŒï¼ˆOpenAI / Anthropic / è‡ªå®šä¹‰ï¼‰
- Docker ä¸€é”®éƒ¨ç½²
- API æ–‡æ¡£å®Œæ•´ï¼ˆSwaggerï¼‰

#### 3. ç”¨æˆ·ä½“éªŒ âœ…
- ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰
- é”™è¯¯å¤„ç†å®Œå–„
- è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- AI ç”Ÿæˆæ”¯æŒé¢„è§ˆæ¨¡å¼

---

### Arboris é¡¹ç›®ç‰¹è‰²åŠŸèƒ½

#### 1. ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ â­
**åŠŸèƒ½æè¿°**ï¼š
- ä¿å­˜ç« èŠ‚çš„å¤šä¸ªè‰ç¨¿ç‰ˆæœ¬
- ç”¨æˆ·å¯ä»¥å¯¹æ¯”ä¸åŒç‰ˆæœ¬
- æ ‡è®°æ»¡æ„çš„å†…å®¹æ®µè½
- ç‰ˆæœ¬å›é€€å’Œæ¢å¤

**ä»·å€¼**ï¼š
- åˆ›ä½œè¿‡ç¨‹å¯è¿½æº¯
- é™ä½ä¿®æ”¹é£é™©
- ä¿ç•™åˆ›æ„çµæ„Ÿ

#### 2. ä¸“ä¸šåŒ– AI åŠ©æ‰‹è§’è‰² â­â­
**åŠŸèƒ½æè¿°**ï¼š
Arboris ä½¿ç”¨ 6 ç§ä¸“é—¨åŒ–çš„ AI åŠ©æ‰‹ï¼š

| åŠ©æ‰‹è§’è‰² | èŒè´£ | åº”ç”¨åœºæ™¯ |
|---------|-----|---------|
| **Conceptualizer** | æ¦‚å¿µåŒ–ï¼Œå¤´è„‘é£æš´ | é¡¹ç›®åˆæœŸï¼Œæ”¶é›†åˆ›æ„ |
| **Blueplanner** | è“å›¾è§„åˆ’ | ç»“æ„åŒ–ä¸–ç•Œè§‚å’Œå¤§çº² |
| **Outliner** | å¤§çº²è¡¥å…… | ç« èŠ‚è§„åˆ’ç»†åŒ– |
| **Novelist** | ç« èŠ‚å†™ä½œ | ç”Ÿæˆå†…å®¹ï¼Œæä¾›2ä¸ªç‰ˆæœ¬ |
| **Extractor** | å†…å®¹å‹ç¼© | ä¸Šä¸‹æ–‡ä¼ é€’ä¼˜åŒ– |
| **Evaluator** | è´¨é‡è¯„ä¼° | å†…å®¹å®¡æŸ¥å’Œæ”¹è¿›å»ºè®® |

**ä»·å€¼**ï¼š
- æ›´ç²¾å‡†çš„ AI è¾“å‡º
- æ˜ç¡®çš„å·¥ä½œæµåˆ’åˆ†
- æå‡ç”Ÿæˆè´¨é‡

#### 3. å®æ—¶åä½œå’Œç¼–è¾‘ â­
**åŠŸèƒ½æè¿°**ï¼š
- ä¸ AI å®æ—¶å¯¹è¯
- è¾¹ç”Ÿæˆè¾¹ç¼–è¾‘
- æµå¼è¾“å‡ºå±•ç¤º

**ä»·å€¼**ï¼š
- æ›´è‡ªç„¶çš„åˆ›ä½œä½“éªŒ
- å‡å°‘ç­‰å¾…æ—¶é—´
- æå‡äº¤äº’æ„Ÿ

#### 4. é«˜åº¦å¯å®šåˆ¶åŒ– â­
**åŠŸèƒ½æè¿°**ï¼š
- ç”¨æˆ·å¯è‡ªå®šä¹‰ prompt æ¨¡æ¿
- æ¨¡å‹å‚æ•°å¯è°ƒ
- æ”¯æŒ Gemini-2.5-flash

**ä»·å€¼**ï¼š
- é€‚åº”ä¸åŒåˆ›ä½œé£æ ¼
- æˆæœ¬ä¼˜åŒ–ï¼ˆä½¿ç”¨æ›´ä¾¿å®œçš„æ¨¡å‹ï¼‰
- æ›´çµæ´»çš„é…ç½®

---

## ä¼˜åŒ–å»ºè®®ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½å¢å¼ºï¼‰

#### 1. å®ç°ç« èŠ‚ç‰ˆæœ¬ç®¡ç†
**é—®é¢˜**ï¼šå½“å‰åªä¿å­˜å•ä¸€ç‰ˆæœ¬ï¼Œä¿®æ”¹åæ— æ³•å›é€€

**æ–¹æ¡ˆ**ï¼š
```sql
-- æ–°å¢è¡¨ï¼šchapter_versions
CREATE TABLE chapter_versions (
    id INTEGER PRIMARY KEY,
    chapter_id INTEGER NOT NULL,
    version_number INTEGER NOT NULL,
    content TEXT,
    created_at TIMESTAMP,
    created_by TEXT,
    is_active BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (chapter_id) REFERENCES chapters(id)
);
```

**åŠŸèƒ½ç‚¹**ï¼š
- æ¯æ¬¡ä¿å­˜åˆ›å»ºæ–°ç‰ˆæœ¬
- ç‰ˆæœ¬åˆ—è¡¨å±•ç¤ºï¼ˆæ—¶é—´ã€åˆ›å»ºè€…ã€é¢„è§ˆï¼‰
- ç‰ˆæœ¬å¯¹æ¯”ï¼ˆdiff æ˜¾ç¤ºï¼‰
- ç‰ˆæœ¬æ¢å¤
- æ ‡è®°å½“å‰æ¿€æ´»ç‰ˆæœ¬

**é¢„æœŸæ”¶ç›Š**ï¼š
- åˆ›ä½œè€…ä¸å†æ‹…å¿ƒä¸¢å¤±å†…å®¹
- å¯ä»¥å¤§èƒ†å°è¯•ä¸åŒå†™æ³•
- å†å²è®°å½•å¯è¿½æº¯

**å®æ–½éš¾åº¦**ï¼šâ­â­ï¼ˆä¸­ç­‰ï¼‰

---

#### 2. å¼•å…¥ AI åŠ©æ‰‹è§’è‰²ç³»ç»Ÿ
**é—®é¢˜**ï¼šå½“å‰ AI ç”ŸæˆåŠŸèƒ½è¾ƒå•ä¸€ï¼Œç¼ºå°‘ä¸“ä¸šåˆ†å·¥

**æ–¹æ¡ˆ**ï¼š
```python
# backend/app/services/ai_assistants.py

class AIAssistant(ABC):
    """AIåŠ©æ‰‹åŸºç±»"""
    role: str
    description: str
    system_prompt: str

    @abstractmethod
    async def process(self, context: dict, user_input: str) -> str:
        pass

class ConceptualizerAssistant(AIAssistant):
    """æ¦‚å¿µåŒ–åŠ©æ‰‹ï¼šå¤´è„‘é£æš´ï¼Œæ”¶é›†åˆ›æ„"""
    role = "conceptualizer"
    system_prompt = """ä½ æ˜¯ä¸€ä¸ªåˆ›æ„åŠ©æ‰‹ï¼Œæ“…é•¿å¤´è„‘é£æš´..."""

class OutlinerAssistant(AIAssistant):
    """å¤§çº²åŠ©æ‰‹ï¼šè¡¥å……å’Œå®Œå–„ç« èŠ‚å¤§çº²"""
    role = "outliner"
    system_prompt = """ä½ æ˜¯ä¸€ä¸ªå¤§çº²è§„åˆ’å¸ˆ..."""

class NovelistAssistant(AIAssistant):
    """å†™ä½œåŠ©æ‰‹ï¼šç”Ÿæˆç« èŠ‚å†…å®¹ï¼Œæä¾›å¤šä¸ªç‰ˆæœ¬"""
    role = "novelist"
    system_prompt = """ä½ æ˜¯ä¸€ä¸ªå°è¯´å®¶..."""

    async def process(self, context: dict, user_input: str) -> List[str]:
        # ç”Ÿæˆ2ä¸ªä¸åŒç‰ˆæœ¬
        version_a = await self.generate(context, style="detailed")
        version_b = await self.generate(context, style="concise")
        return [version_a, version_b]

class EvaluatorAssistant(AIAssistant):
    """è¯„ä¼°åŠ©æ‰‹ï¼šåˆ†æå†…å®¹è´¨é‡ï¼Œæä¾›æ”¹è¿›å»ºè®®"""
    role = "evaluator"
    system_prompt = """ä½ æ˜¯ä¸€ä¸ªæ–‡å­¦è¯„è®ºå®¶..."""
```

**API ç«¯ç‚¹**ï¼š
```python
@router.post("/api/ai/assistants/{role}/generate")
async def generate_with_assistant(
    role: str,
    payload: AIAssistantRequest,
    db: Session = Depends(get_db)
):
    assistant = AIAssistantFactory.create(role)
    result = await assistant.process(payload.context, payload.input)
    return {"role": role, "content": result}
```

**å‰ç«¯ç•Œé¢**ï¼š
```vue
<el-select v-model="selectedAssistant">
  <el-option label="æ¦‚å¿µåŒ–åŠ©æ‰‹" value="conceptualizer" />
  <el-option label="å¤§çº²åŠ©æ‰‹" value="outliner" />
  <el-option label="å†™ä½œåŠ©æ‰‹" value="novelist" />
  <el-option label="è¯„ä¼°åŠ©æ‰‹" value="evaluator" />
</el-select>
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- AI è¾“å‡ºæ›´åŠ ç²¾å‡†å’Œä¸“ä¸š
- å·¥ä½œæµæ›´åŠ æ¸…æ™°
- ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡

**å®æ–½éš¾åº¦**ï¼šâ­â­â­ï¼ˆè¾ƒé«˜ï¼‰

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼‰

#### 3. æ·»åŠ å†…å®¹è¯„ä¼°åŠŸèƒ½
**é—®é¢˜**ï¼šç”¨æˆ·ä¸çŸ¥é“ç”Ÿæˆçš„å†…å®¹è´¨é‡å¦‚ä½•

**æ–¹æ¡ˆ**ï¼š
```python
@router.post("/api/ai/evaluate-content")
async def evaluate_content(
    chapter_id: int,
    db: Session = Depends(get_db)
):
    """è¯„ä¼°ç« èŠ‚å†…å®¹è´¨é‡"""
    chapter = db.query(Chapter).filter(Chapter.id == chapter_id).first()
    evaluator = EvaluatorAssistant()

    evaluation = await evaluator.evaluate(chapter.content)

    return {
        "score": evaluation.score,  # 1-10
        "strengths": evaluation.strengths,  # ä¼˜ç‚¹åˆ—è¡¨
        "weaknesses": evaluation.weaknesses,  # ç¼ºç‚¹åˆ—è¡¨
        "suggestions": evaluation.suggestions  # æ”¹è¿›å»ºè®®
    }
```

**å‰ç«¯å±•ç¤º**ï¼š
```vue
<el-card>
  <template #header>å†…å®¹è¯„ä¼°æŠ¥å‘Š</template>
  <el-rate v-model="evaluation.score" disabled />

  <h4>âœ… ä¼˜ç‚¹</h4>
  <ul>
    <li v-for="s in evaluation.strengths">{{ s }}</li>
  </ul>

  <h4>âš ï¸ éœ€è¦æ”¹è¿›</h4>
  <ul>
    <li v-for="w in evaluation.weaknesses">{{ w }}</li>
  </ul>

  <h4>ğŸ’¡ å»ºè®®</h4>
  <ul>
    <li v-for="s in evaluation.suggestions">{{ s }}</li>
  </ul>
</el-card>
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- å¸®åŠ©ç”¨æˆ·è¯†åˆ«å†…å®¹è´¨é‡
- æä¾›å…·ä½“çš„æ”¹è¿›æ–¹å‘
- æå‡æœ€ç»ˆä½œå“è´¨é‡

**å®æ–½éš¾åº¦**ï¼šâ­â­ï¼ˆä¸­ç­‰ï¼‰

---

#### 4. å®ç°æµå¼è¾“å‡ºï¼ˆStreamingï¼‰
**é—®é¢˜**ï¼šç”Ÿæˆè¾ƒé•¿å†…å®¹æ—¶ï¼Œç”¨æˆ·éœ€è¦ç­‰å¾…å¾ˆä¹…

**æ–¹æ¡ˆ**ï¼š
```python
from fastapi.responses import StreamingResponse

@router.post("/api/ai/generate-stream")
async def generate_with_streaming(payload: AIGenerateRequest):
    """æµå¼ç”Ÿæˆå†…å®¹"""
    async def event_generator():
        service = AIService(...)
        async for chunk in service.generate_stream(payload.prompt):
            yield f"data: {json.dumps({'content': chunk})}\n\n"

    return StreamingResponse(
        event_generator(),
        media_type="text/event-stream"
    )
```

**å‰ç«¯å®ç°**ï¼š
```typescript
const eventSource = new EventSource('/api/ai/generate-stream')
eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data)
  content.value += data.content  // å®æ—¶è¿½åŠ 
}
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- ç”¨æˆ·ä½“éªŒæ›´æµç•…
- å‡å°‘æ„ŸçŸ¥ç­‰å¾…æ—¶é—´
- æ›´åƒçœŸå®çš„å¯¹è¯

**å®æ–½éš¾åº¦**ï¼šâ­â­â­ï¼ˆè¾ƒé«˜ï¼‰

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰

#### 5. æ·»åŠ  Prompt æ¨¡æ¿ç®¡ç†
**é—®é¢˜**ï¼šå½“å‰ prompt ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œä¸ä¾¿äºè°ƒæ•´

**æ–¹æ¡ˆ**ï¼š
```python
# ä½¿ç”¨ç°æœ‰çš„ prompts è¡¨
@router.get("/api/prompts/")
async def list_prompts(db: Session = Depends(get_db)):
    """è·å–æ‰€æœ‰ prompt æ¨¡æ¿"""
    return db.query(Prompt).all()

@router.put("/api/prompts/{name}")
async def update_prompt(name: str, content: str, db: Session = Depends(get_db)):
    """æ›´æ–° prompt æ¨¡æ¿"""
    prompt = db.query(Prompt).filter(Prompt.name == name).first()
    if prompt:
        prompt.content = content
        db.commit()
```

**å‰ç«¯ç®¡ç†ç•Œé¢**ï¼š
```vue
<el-form>
  <el-form-item label="è§’è‰²ç”Ÿæˆ Prompt">
    <el-input type="textarea" v-model="prompts.character" :rows="10" />
  </el-form-item>
  <el-button @click="savePrompt('character')">ä¿å­˜</el-button>
</el-form>
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ AI è¡Œä¸º
- æ— éœ€ä¿®æ”¹ä»£ç å³å¯è°ƒæ•´
- æ”¯æŒä¸åŒåˆ›ä½œé£æ ¼

**å®æ–½éš¾åº¦**ï¼šâ­ï¼ˆç®€å•ï¼‰

---

#### 6. æ”¯æŒæ›´å¤š AI Provider
**é—®é¢˜**ï¼šä»…æ”¯æŒ OpenAI å’Œ Anthropic

**å»ºè®®æ–°å¢**ï¼š
- âœ… Gemini (Google)
- âœ… é€šä¹‰åƒé—® (Alibaba)
- âœ… æ–‡å¿ƒä¸€è¨€ (Baidu)
- âœ… Kimi (Moonshot)

**æ–¹æ¡ˆ**ï¼š
```python
class GeminiProvider(BaseAIProvider):
    async def generate(self, prompt: str) -> str:
        # è°ƒç”¨ Gemini API
        pass

class QwenProvider(BaseAIProvider):
    async def generate(self, prompt: str) -> str:
        # è°ƒç”¨é€šä¹‰åƒé—® API
        pass
```

**é¢„æœŸæ”¶ç›Š**ï¼š
- é™ä½ä½¿ç”¨æˆæœ¬
- æ”¯æŒå›½å†…ç”¨æˆ·
- æä¾›æ›´å¤šé€‰æ‹©

**å®æ–½éš¾åº¦**ï¼šâ­â­ï¼ˆä¸­ç­‰ï¼‰

---

## å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€ä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰
- âœ… **Bug ä¿®å¤**ï¼ˆå·²å®Œæˆï¼‰
- ğŸ”„ æ·»åŠ ç« èŠ‚ç‰ˆæœ¬ç®¡ç†
- ğŸ”„ Prompt æ¨¡æ¿ç®¡ç†ç•Œé¢

### Phase 2: æ ¸å¿ƒåŠŸèƒ½å¢å¼ºï¼ˆ2-3å‘¨ï¼‰
- ğŸ”„ å®ç° AI åŠ©æ‰‹è§’è‰²ç³»ç»Ÿ
- ğŸ”„ æ·»åŠ å†…å®¹è¯„ä¼°åŠŸèƒ½
- ğŸ”„ æ”¹è¿›é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### Phase 3: ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆ2å‘¨ï¼‰
- ğŸ”„ å®ç°æµå¼è¾“å‡º
- ğŸ”„ ä¼˜åŒ–å‰ç«¯æ€§èƒ½
- ğŸ”„ æ·»åŠ å¿«æ·é”®æ”¯æŒ

### Phase 4: æ‰©å±•åŠŸèƒ½ï¼ˆæŒç»­ï¼‰
- ğŸ”„ æ”¯æŒæ›´å¤š AI Provider
- ğŸ”„ æ·»åŠ å¯¼å‡ºåŠŸèƒ½ï¼ˆPDF, EPUBï¼‰
- ğŸ”„ å®ç°åä½œåŠŸèƒ½

---

## Linus é£æ ¼è¯„ä¼°

### è¿™äº›ä¼˜åŒ–æ˜¯çœŸå®éœ€æ±‚è¿˜æ˜¯è¿‡åº¦è®¾è®¡ï¼Ÿ
**çœŸå®éœ€æ±‚**ï¼š
- âœ… ç‰ˆæœ¬ç®¡ç†ï¼šåˆ›ä½œè€…çš„æ ¸å¿ƒç—›ç‚¹
- âœ… AI åŠ©æ‰‹è§’è‰²ï¼šæå‡ç”Ÿæˆè´¨é‡
- â“ æµå¼è¾“å‡ºï¼šç”¨æˆ·ä½“éªŒæ”¹è¿›ï¼Œéæ ¸å¿ƒ
- âŒ è¿‡åº¦å¤æ‚çš„åŠŸèƒ½ï¼šåº”è¯¥é¿å…

### æœ€ç®€å®ç°æ–¹æ¡ˆ
ä¼˜å…ˆçº§æ’åºåŸåˆ™ï¼š
1. è§£å†³æ ¸å¿ƒç—›ç‚¹ > é”¦ä¸Šæ·»èŠ±
2. æ•°æ®ç»“æ„ä¼˜åŒ– > é€»è¾‘æ‰“è¡¥ä¸
3. ç”¨æˆ·ä»·å€¼ > æŠ€æœ¯ç‚«æŠ€

### ä¼šç ´åä»€ä¹ˆï¼Ÿ
- ç‰ˆæœ¬ç®¡ç†ï¼šéœ€è¦æ•°æ®åº“è¿ç§»ï¼ˆå¯ç”¨ Alembicï¼‰
- AI åŠ©æ‰‹ï¼šä¸ç ´åç°æœ‰åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- æµå¼è¾“å‡ºï¼šéœ€è¦å®¢æˆ·ç«¯æ”¯æŒ SSE

**å…¼å®¹æ€§ç­–ç•¥**ï¼š
- æ–°åŠŸèƒ½ç‹¬ç«‹æ¨¡å—
- ä¿æŒç°æœ‰ API ä¸å˜
- é€æ­¥è¿ç§»

---

## æ€»ç»“

å½“å‰é¡¹ç›®å·²ç»å…·å¤‡äº†åšå®çš„åŸºç¡€å’Œå®Œæ•´çš„åŠŸèƒ½ã€‚å¯¹æ¯” Arborisï¼Œæ ¸å¿ƒå·®è·åœ¨äºï¼š

1. **ç¼ºå°‘ç‰ˆæœ¬ç®¡ç†** - é«˜ä¼˜å…ˆçº§ï¼Œåº”å°½å¿«å®ç°
2. **AI åŠŸèƒ½è¾ƒå•ä¸€** - å¯ä»¥é€šè¿‡åŠ©æ‰‹è§’è‰²ç³»ç»Ÿæå‡
3. **ç”¨æˆ·ä½“éªŒå¯ä¼˜åŒ–** - æµå¼è¾“å‡ºã€å®æ—¶ç¼–è¾‘ç­‰

**å»ºè®®**ï¼š
- âœ… ç«‹å³å®ç°ç‰ˆæœ¬ç®¡ç†
- âœ… åˆ†é˜¶æ®µå¼•å…¥ AI åŠ©æ‰‹è§’è‰²
- â¸ï¸ å…¶ä»–åŠŸèƒ½æ ¹æ®ç”¨æˆ·åé¦ˆå†³å®š

**å“²å­¦**ï¼š
> "Perfect is the enemy of good" - Voltaire
>
> ä¸è¦è¿½æ±‚ä¸€æ¬¡æ€§å®ç°æ‰€æœ‰åŠŸèƒ½ï¼Œå…ˆè§£å†³æ ¸å¿ƒç—›ç‚¹ï¼Œå†é€æ­¥ä¼˜åŒ–ã€‚
